<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🐼 ペルコちゃんシューティングゲーム</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #87CEEB, #FFB6C1);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Comic Sans MS', cursive;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        
        #gameContainer {
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        #gameCanvas {
            border: 3px solid #333;
            border-radius: 10px;
            background: #87CEEB;
            position: relative;
        }
        
        h1 {
            color: #333;
            margin: 0 0 10px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        #score {
            color: #333;
            font-size: 18px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        #instructions {
            color: #666;
            font-size: 14px;
            margin: 10px 0;
        }
        
        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 100;
        }
        
        button {
            background: #FF69B4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #FF1493;
            transform: scale(1.05);
        }
        
        #controls {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }
        
        #soundToggle {
            background: #4169E1;
            padding: 8px 16px;
            font-size: 14px;
        }
        
        #soundToggle:hover {
            background: #1E90FF;
        }
        
        .panda-icon {
            display: inline-block;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .game-info {
            margin-top: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
        }
        
        .game-info h3 {
            margin-top: 0;
            color: #FF69B4;
        }
        
        .game-info ul {
            text-align: left;
            padding-left: 20px;
        }
        
        /* スマホ用コントロールボタン */
        .mobile-controls {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
        }
        
        .control-button {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.8);
            border: 3px solid #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: #333;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            transition: all 0.2s;
        }
        
        .control-button:active {
            background: rgba(255, 105, 180, 0.8);
            transform: scale(0.95);
        }
        
        .control-button:hover {
            background: rgba(255, 105, 180, 0.6);
        }
        
        #leftButton {
            left: -50px;
        }
        
        #rightButton {
            right: -50px;
        }
        
        /* レスポンシブ対応 */
        @media (max-width: 768px) {
            #gameContainer {
                padding: 10px;
                margin: 10px;
            }
            
            #gameCanvas {
                max-width: 100%;
                height: auto;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .control-button {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }
            
            #leftButton {
                left: -40px;
            }
            
            #rightButton {
                right: -40px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <h1><span class="panda-icon">🐼</span> ペルコちゃんシューティングゲーム <span class="panda-icon">🎯</span></h1>
        <div id="score">スコア: 0</div>
        
        <div style="position: relative;">
            <canvas id="gameCanvas" width="800" height="600"></canvas>
            
            <!-- スマホ用コントロールボタン -->
            <div class="mobile-controls" id="leftButton">
                <div class="control-button">←</div>
            </div>
            <div class="mobile-controls" id="rightButton">
                <div class="control-button">→</div>
            </div>
            
            <!-- スマホ用ゲーム開始ボタン -->
            <div id="mobileStartButton" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 20; display: block; pointer-events: auto;">
                <button id="startBtn" style="padding: 20px 40px; font-size: 24px; background: #FF69B4; color: white; border: none; border-radius: 15px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.3); pointer-events: auto;">
                    タップしてスタート！
                </button>
            </div>
        </div>
        
        <div id="instructions">
            左右ボタンで移動、弾は自動発射！<br>
            可愛いペルコちゃんでパイルを倒そう！
        </div>
        
        <div id="controls">
            <button id="soundToggle">🔊 サウンド ON/OFF</button>
        </div>
        
        <div class="game-info">
            <h3>アイテム一覧</h3>
            <ul>
                <li>❤️ ハート - ライフ回復</li>
                <li>🔱 3WAY - 3方向に弾を発射</li>
                <li>⚡ レーザー - 強力な貫通攻撃</li>
                <li>🛡️ シールド - 一定時間無敵（攻撃も可能）</li>
            </ul>
        </div>
        
        <div id="gameOver">
            <h2 id="gameOverTitle">ゲーム終了</h2>
            <p id="finalScore">最終スコア: 0</p>
            <button id="restartButton">もう一度遊ぶ</button>
        </div>
    </div>

    <script>
        // サウンド管理
        let soundEnabled = true;
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            
            const soundButton = document.getElementById('soundToggle');
            soundButton.textContent = soundEnabled ? '🔊 サウンド ON/OFF' : '🔇 サウンド ON/OFF';
            
            // ゲームのサウンド設定を更新
            if (window.updateSoundSettings) {
                window.updateSoundSettings(soundEnabled);
            }
        }
        
        // ボタンのイベントリスナーを追加
        document.addEventListener('DOMContentLoaded', function() {
            const soundButton = document.getElementById('soundToggle');
            if (soundButton) {
                soundButton.addEventListener('click', toggleSound);
            }
            
            const restartButton = document.getElementById('restartButton');
            if (restartButton) {
                restartButton.addEventListener('click', function() {
                    if (window.restartGame) {
                        window.restartGame();
                    }
                });
            }
            
            // コントロールボタンを初期化
            initializeControlButtons();
            
            // ゲーム開始イベントを初期化
            initializeGameStartEvents();
        });
        
        // エラーハンドリングを追加
        window.addEventListener('error', function(e) {
            console.error('JavaScript Error:', e.error);
        });
        
        // スマホ用コントロール
        let leftPressed = false;
        let rightPressed = false;
        
        // コントロールボタンの初期化
        function initializeControlButtons() {
            const leftButton = document.getElementById('leftButton');
            const rightButton = document.getElementById('rightButton');
            
            if (!leftButton || !rightButton) return;
            
            // 左ボタンイベント
            const leftEvents = {
                start: (e) => {
                    e.preventDefault();
                    leftPressed = true;
                    if (window.setMobileControl) {
                        window.setMobileControl('left', true);
                    }
                },
                end: (e) => {
                    e.preventDefault();
                    leftPressed = false;
                    if (window.setMobileControl) {
                        window.setMobileControl('left', false);
                    }
                }
            };
            
            // 右ボタンイベント
            const rightEvents = {
                start: (e) => {
                    e.preventDefault();
                    rightPressed = true;
                    if (window.setMobileControl) {
                        window.setMobileControl('right', true);
                    }
                },
                end: (e) => {
                    e.preventDefault();
                    rightPressed = false;
                    if (window.setMobileControl) {
                        window.setMobileControl('right', false);
                    }
                }
            };
            
            // タッチイベント
            leftButton.addEventListener('touchstart', leftEvents.start);
            leftButton.addEventListener('touchend', leftEvents.end);
            rightButton.addEventListener('touchstart', rightEvents.start);
            rightButton.addEventListener('touchend', rightEvents.end);
            
            // マウスイベント（PC用）
            leftButton.addEventListener('mousedown', leftEvents.start);
            leftButton.addEventListener('mouseup', leftEvents.end);
            rightButton.addEventListener('mousedown', rightEvents.start);
            rightButton.addEventListener('mouseup', rightEvents.end);
        }
        
        // タッチ操作でのスクロール防止
        document.addEventListener('touchmove', function(e) {
            e.preventDefault();
        }, { passive: false });
        
        // ゲーム開始イベントの初期化
        function initializeGameStartEvents() {
            const startButton = document.getElementById('startBtn');
            const mobileStartButton = document.getElementById('mobileStartButton');
            const gameCanvas = document.getElementById('gameCanvas');
            
            const handleStart = (e) => {
                e.preventDefault();
                e.stopPropagation();
                console.log('Game start triggered');
                if (window.handleMobileStart) {
                    window.handleMobileStart();
                }
            };
            
            const handleCanvasInteraction = (e) => {
                e.preventDefault();
                console.log('Canvas interaction');
                if (window.handleCanvasTouch) {
                    window.handleCanvasTouch();
                }
            };
            
            // スタートボタンイベント
            if (startButton) {
                startButton.addEventListener('click', handleStart);
                startButton.addEventListener('touchstart', handleStart);
            }
            
            // モバイルスタートボタンイベント
            if (mobileStartButton) {
                mobileStartButton.addEventListener('click', handleStart);
                mobileStartButton.addEventListener('touchstart', handleStart);
            }
            
            // キャンバスイベント
            if (gameCanvas) {
                gameCanvas.addEventListener('click', handleCanvasInteraction);
                gameCanvas.addEventListener('touchstart', handleCanvasInteraction);
            }
        }
    </script>
    <script src="game.js"></script>
</body>
</html>
