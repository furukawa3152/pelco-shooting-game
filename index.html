<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¼ ãƒšãƒ«ã‚³ã¡ã‚ƒã‚“ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚²ãƒ¼ãƒ </title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #87CEEB, #FFB6C1);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Comic Sans MS', cursive;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        
        #gameContainer {
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        #gameCanvas {
            border: 3px solid #333;
            border-radius: 10px;
            background: #87CEEB;
            position: relative;
        }
        
        h1 {
            color: #333;
            margin: 0 0 10px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        #score {
            color: #333;
            font-size: 18px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        #instructions {
            color: #666;
            font-size: 14px;
            margin: 10px 0;
        }
        
        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 100;
        }
        
        button {
            background: #FF69B4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #FF1493;
            transform: scale(1.05);
        }
        
        #controls {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }
        
        #soundToggle {
            background: #4169E1;
            padding: 8px 16px;
            font-size: 14px;
        }
        
        #soundToggle:hover {
            background: #1E90FF;
        }
        
        .panda-icon {
            display: inline-block;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .game-info {
            margin-top: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
        }
        
        .game-info h3 {
            margin-top: 0;
            color: #FF69B4;
        }
        
        .game-info ul {
            text-align: left;
            padding-left: 20px;
        }
        
        /* ã‚¹ãƒãƒ›ç”¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ */
        .mobile-controls {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
        }
        
        .control-button {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.8);
            border: 3px solid #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: #333;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            transition: all 0.2s;
        }
        
        .control-button:active {
            background: rgba(255, 105, 180, 0.8);
            transform: scale(0.95);
        }
        
        .control-button:hover {
            background: rgba(255, 105, 180, 0.6);
        }
        
        #leftButton {
            left: -50px;
        }
        
        #rightButton {
            right: -50px;
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            #gameContainer {
                padding: 10px;
                margin: 10px;
            }
            
            #gameCanvas {
                max-width: 100%;
                height: auto;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .control-button {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }
            
            #leftButton {
                left: -40px;
            }
            
            #rightButton {
                right: -40px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <h1><span class="panda-icon">ğŸ¼</span> ãƒšãƒ«ã‚³ã¡ã‚ƒã‚“ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚²ãƒ¼ãƒ  <span class="panda-icon">ğŸ¯</span></h1>
        <div id="score">ã‚¹ã‚³ã‚¢: 0</div>
        
        <div style="position: relative;">
            <canvas id="gameCanvas" width="800" height="600"></canvas>
            
            <!-- ã‚¹ãƒãƒ›ç”¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ -->
            <div class="mobile-controls" id="leftButton">
                <div class="control-button">â†</div>
            </div>
            <div class="mobile-controls" id="rightButton">
                <div class="control-button">â†’</div>
            </div>
            
            <!-- ã‚¹ãƒãƒ›ç”¨ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ -->
            <div id="mobileStartButton" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 20; display: block; pointer-events: auto;">
                <button id="startBtn" style="padding: 20px 40px; font-size: 24px; background: #FF69B4; color: white; border: none; border-radius: 15px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.3); pointer-events: auto;">
                    ã‚¿ãƒƒãƒ—ã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆï¼
                </button>
            </div>
        </div>
        
        <div id="instructions">
            å·¦å³ãƒœã‚¿ãƒ³ã§ç§»å‹•ã€å¼¾ã¯è‡ªå‹•ç™ºå°„ï¼<br>
            å¯æ„›ã„ãƒšãƒ«ã‚³ã¡ã‚ƒã‚“ã§ãƒ‘ã‚¤ãƒ«ã‚’å€’ãã†ï¼
        </div>
        
        <div id="controls">
            <button id="soundToggle">ğŸ”Š ã‚µã‚¦ãƒ³ãƒ‰ ON/OFF</button>
        </div>
        
        <div class="game-info">
            <h3>ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§</h3>
            <ul>
                <li>â¤ï¸ ãƒãƒ¼ãƒˆ - ãƒ©ã‚¤ãƒ•å›å¾©</li>
                <li>ğŸ”± 3WAY - 3æ–¹å‘ã«å¼¾ã‚’ç™ºå°„</li>
                <li>âš¡ ãƒ¬ãƒ¼ã‚¶ãƒ¼ - å¼·åŠ›ãªè²«é€šæ”»æ’ƒ</li>
                <li>ğŸ›¡ï¸ ã‚·ãƒ¼ãƒ«ãƒ‰ - ä¸€å®šæ™‚é–“ç„¡æ•µï¼ˆæ”»æ’ƒã‚‚å¯èƒ½ï¼‰</li>
            </ul>
        </div>
        
        <div id="gameOver">
            <h2 id="gameOverTitle">ã‚²ãƒ¼ãƒ çµ‚äº†</h2>
            <p id="finalScore">æœ€çµ‚ã‚¹ã‚³ã‚¢: 0</p>
            <button id="restartButton">ã‚‚ã†ä¸€åº¦éŠã¶</button>
        </div>
    </div>

    <script>
        // ã‚µã‚¦ãƒ³ãƒ‰ç®¡ç†
        let soundEnabled = true;
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            
            const soundButton = document.getElementById('soundToggle');
            soundButton.textContent = soundEnabled ? 'ğŸ”Š ã‚µã‚¦ãƒ³ãƒ‰ ON/OFF' : 'ğŸ”‡ ã‚µã‚¦ãƒ³ãƒ‰ ON/OFF';
            
            // ã‚²ãƒ¼ãƒ ã®ã‚µã‚¦ãƒ³ãƒ‰è¨­å®šã‚’æ›´æ–°
            if (window.updateSoundSettings) {
                window.updateSoundSettings(soundEnabled);
            }
        }
        
        // ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
        document.addEventListener('DOMContentLoaded', function() {
            const soundButton = document.getElementById('soundToggle');
            if (soundButton) {
                soundButton.addEventListener('click', toggleSound);
            }
            
            const restartButton = document.getElementById('restartButton');
            if (restartButton) {
                restartButton.addEventListener('click', function() {
                    if (window.restartGame) {
                        window.restartGame();
                    }
                });
            }
            
            // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ã‚’åˆæœŸåŒ–
            initializeControlButtons();
            
            // ã‚²ãƒ¼ãƒ é–‹å§‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’åˆæœŸåŒ–
            initializeGameStartEvents();
        });
        
        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¿½åŠ 
        window.addEventListener('error', function(e) {
            console.error('JavaScript Error:', e.error);
        });
        
        // ã‚¹ãƒãƒ›ç”¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
        let leftPressed = false;
        let rightPressed = false;
        
        // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ã®åˆæœŸåŒ–
        function initializeControlButtons() {
            const leftButton = document.getElementById('leftButton');
            const rightButton = document.getElementById('rightButton');
            
            if (!leftButton || !rightButton) return;
            
            // å·¦ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
            const leftEvents = {
                start: (e) => {
                    e.preventDefault();
                    leftPressed = true;
                    if (window.setMobileControl) {
                        window.setMobileControl('left', true);
                    }
                },
                end: (e) => {
                    e.preventDefault();
                    leftPressed = false;
                    if (window.setMobileControl) {
                        window.setMobileControl('left', false);
                    }
                }
            };
            
            // å³ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
            const rightEvents = {
                start: (e) => {
                    e.preventDefault();
                    rightPressed = true;
                    if (window.setMobileControl) {
                        window.setMobileControl('right', true);
                    }
                },
                end: (e) => {
                    e.preventDefault();
                    rightPressed = false;
                    if (window.setMobileControl) {
                        window.setMobileControl('right', false);
                    }
                }
            };
            
            // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆ
            leftButton.addEventListener('touchstart', leftEvents.start);
            leftButton.addEventListener('touchend', leftEvents.end);
            rightButton.addEventListener('touchstart', rightEvents.start);
            rightButton.addEventListener('touchend', rightEvents.end);
            
            // ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆPCç”¨ï¼‰
            leftButton.addEventListener('mousedown', leftEvents.start);
            leftButton.addEventListener('mouseup', leftEvents.end);
            rightButton.addEventListener('mousedown', rightEvents.start);
            rightButton.addEventListener('mouseup', rightEvents.end);
        }
        
        // ã‚¿ãƒƒãƒæ“ä½œã§ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢
        document.addEventListener('touchmove', function(e) {
            e.preventDefault();
        }, { passive: false });
        
        // ã‚²ãƒ¼ãƒ é–‹å§‹ã‚¤ãƒ™ãƒ³ãƒˆã®åˆæœŸåŒ–
        function initializeGameStartEvents() {
            const startButton = document.getElementById('startBtn');
            const mobileStartButton = document.getElementById('mobileStartButton');
            const gameCanvas = document.getElementById('gameCanvas');
            
            const handleStart = (e) => {
                e.preventDefault();
                e.stopPropagation();
                console.log('Game start triggered');
                if (window.handleMobileStart) {
                    window.handleMobileStart();
                }
            };
            
            const handleCanvasInteraction = (e) => {
                e.preventDefault();
                console.log('Canvas interaction');
                if (window.handleCanvasTouch) {
                    window.handleCanvasTouch();
                }
            };
            
            // ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
            if (startButton) {
                startButton.addEventListener('click', handleStart);
                startButton.addEventListener('touchstart', handleStart);
            }
            
            // ãƒ¢ãƒã‚¤ãƒ«ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
            if (mobileStartButton) {
                mobileStartButton.addEventListener('click', handleStart);
                mobileStartButton.addEventListener('touchstart', handleStart);
            }
            
            // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¤ãƒ™ãƒ³ãƒˆ
            if (gameCanvas) {
                gameCanvas.addEventListener('click', handleCanvasInteraction);
                gameCanvas.addEventListener('touchstart', handleCanvasInteraction);
            }
        }
    </script>
    <script src="game.js"></script>
</body>
</html>
